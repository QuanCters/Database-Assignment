CREATE DATABASE assignment2;
GO
USE assignment2;
CREATE TABLE nhan_vien (
	Ma_so_nhan_vien	CHAR(10) PRIMARY KEY,
    CCCD			CHAR(12),
    Ho				CHAR(10),
    Ten				CHAR(10),
    Gioi_tinh		VARCHAR(3) CHECK (Gioi_tinh = 'Nam' OR Gioi_tinh = 'Nu'),
    Dia_chi			VARCHAR(255),
    Email			VARCHAR(100),
    Ngay_ky_hop_dong	DATE,
    Luong			INT,
    Ngay_sinh		DATE
);
CREATE TABLE so_dien_thoai_nhan_vien (
	Ma_so_nhan_vien	CHAR(10),
    So_dien_thoai	CHAR(10) NOT NULL,
    PRIMARY KEY (Ma_so_nhan_vien, So_dien_thoai),
    FOREIGN KEY (Ma_so_nhan_vien) REFERENCES nhan_vien(Ma_so_nhan_vien)
);
CREATE TABLE bac_si (
	Ma_so_nhan_vien	CHAR(10) PRIMARY KEY,
    Chuc_vu			VARCHAR(50),
    Bang_cap		VARCHAR(50),
    Chuyen_khoa		VARCHAR(50),
    Ma_so_quan_ly	CHAR(10),
    FOREIGN KEY (Ma_so_nhan_vien) REFERENCES nhan_vien(Ma_so_nhan_vien),
    FOREIGN KEY (Ma_so_quan_ly) REFERENCES bac_si(Ma_so_nhan_vien)
);
CREATE TABLE lich_lam_viec (
	So_hieu_ca_lam_viec	CHAR(10) PRIMARY KEY,
    Ngay				DATE,
    Ma_so_nhan_vien		CHAR(10),
    FOREIGN KEY (Ma_so_nhan_vien) REFERENCES bac_si(Ma_so_nhan_vien)
);
CREATE TABLE ca_lam_viec (
	So_hieu_ca_lam_viec	CHAR(10),
    Gio_vao				TIME,
    Gio_tan_ca			TIME,
    PRIMARY KEY (So_hieu_ca_lam_viec, Gio_vao, Gio_tan_ca),
    FOREIGN KEY (So_hieu_ca_lam_viec) REFERENCES lich_lam_viec(So_hieu_ca_lam_viec)
);
CREATE TABLE dieu_duong (
	Ma_so_nhan_vien	CHAR(10) PRIMARY KEY,
    Trinh_do				VARCHAR(50),
    Hang_chuc_nghe_nghiep	VARCHAR(50),
    FOREIGN KEY (Ma_so_nhan_vien) REFERENCES nhan_vien(Ma_so_nhan_vien)
);
CREATE TABLE benh_nhan (
	Ma_benh_nhan	CHAR(10) PRIMARY KEY,
    CCCD			CHAR(12),
    Ho				VARCHAR(10),
    Ten				VARCHAR(10),
    Dia_chi			VARCHAR(255),
    Email			VARCHAR(100),
    Gioi_tinh 		VARCHAR(3) CHECK (Gioi_tinh = 'Nam' OR Gioi_tinh = 'Nu'),
    Ngay_sinh		DATE
);
CREATE TABLE the_bhyt (
	Ma_bhyt				CHAR(13) PRIMARY KEY,
    Noi_song					VARCHAR(255),
    Noi_dang_ky_kham_chua_benh	VARCHAR(100),
    Ma_ki_hieu_muc_huong		CHAR(2),
    Ma_benh_nhan				CHAR(10),
    FOREIGN KEY (Ma_benh_nhan) REFERENCES benh_nhan(Ma_benh_nhan)
);
CREATE TABLE thong_tin_theo_doi_suc_khoe (
	Ma_benh_nhan		CHAR(10),
    Ngay				DATE,
    Gio					TIME,
    Can_nang			FLOAT,
    Chieu_cao			INT,
    Huyet_ap			VARCHAR(10),
    BMI					FLOAT,
    Phan_loai_suc_khoe	VARCHAR(10),
    PRIMARY KEY (Ma_benh_nhan, Ngay, Gio),
    FOREIGN KEY (Ma_benh_nhan) REFERENCES benh_nhan(Ma_benh_nhan)
);
CREATE TABLE so_dien_thoai_benh_nhan (
	Ma_benh_nhan	CHAR(10),
    So_dien_thoai	CHAR(10) NOT NULL,
    PRIMARY KEY (Ma_benh_nhan, So_dien_thoai),
    FOREIGN KEY (Ma_benh_nhan) REFERENCES benh_nhan(Ma_benh_nhan)
);
CREATE TABLE than_nhan (
	Ma_benh_nhan	CHAR(10),
    Ten				VARCHAR(100),
    Dia_chi			VARCHAR(255),
    PRIMARY KEY (Ma_benh_nhan, Ten),
    FOREIGN KEY (Ma_benh_nhan) REFERENCES benh_nhan(Ma_benh_nhan)
);
CREATE TABLE lien_lac_cua_than_nhan (
	Ma_benh_nhan	CHAR(10),
    Ten				VARCHAR(100),
    So_dien_thoai	CHAR(10),
    Email			VARCHAR(100),
    PRIMARY KEY (Ma_benh_nhan, Ten, So_dien_thoai, Email),
    FOREIGN KEY (Ma_benh_nhan, Ten) REFERENCES than_nhan(Ma_benh_nhan, Ten)
);
CREATE TABLE lan_di_benh_vien (
	Ma_so			CHAR(10) PRIMARY KEY,
    Gio				TIME,
    Ngay			DATE,
    Tong_chi_phi	INT,
    Ma_benh_nhan	CHAR(10),
    FOREIGN KEY (Ma_benh_nhan) REFERENCES benh_nhan(Ma_benh_nhan)
);
CREATE TABLE loai_dich_vu (
	Ma_loai_dich_vu	CHAR(10) PRIMARY KEY,
    Ten_dich_vu		VARCHAR(100),
    Mo_ta			VARCHAR(255)
);
CREATE TABLE lan_su_dung_dich_vu (
	Ma_so					CHAR(10) PRIMARY KEY,
    Ma_so_nhan_vien			CHAR(10),
    Ma_so_lan_di_benh_vien	CHAR(10),
    Ma_loai_dich_vu			CHAR(10),
    FOREIGN KEY (Ma_so_nhan_vien) REFERENCES bac_si(Ma_so_nhan_vien),
    FOREIGN KEY (Ma_so_lan_di_benh_vien) REFERENCES lan_di_benh_vien(Ma_so),
    FOREIGN KEY (Ma_loai_dich_vu) REFERENCES loai_dich_vu(Ma_loai_dich_vu)
);
CREATE TABLE dich_vu_noi_soi (
	Ma_so			CHAR(10) PRIMARY KEY,
    Co_quan			VARCHAR(100),
    Phuong_phap		VARCHAR(100),
    Chi_phi			INT,
    FOREIGN KEY (Ma_so) REFERENCES lan_su_dung_dich_vu(Ma_so)
);
CREATE TABLE dich_vu_xet_nghiem (
	Ma_so				CHAR(10) PRIMARY KEY,
    Ket_qua_xet_nghiem	VARCHAR(100),
    Loai_xet_nghiem		VARCHAR(100),
    Loai_mau 			VARCHAR(100),
    Chi_phi				INT,
    FOREIGN KEY (Ma_so) REFERENCES lan_su_dung_dich_vu(Ma_so)
);
CREATE TABLE dich_vu_chup_ct_xquang (
	Ma_so			CHAR(10) PRIMARY KEY,
    Vi_tri_chup		VARCHAR(100),
    Kieu_x_quang	VARCHAR(100),
    Chi_phi			INT,
    FOREIGN KEY (Ma_so) REFERENCES lan_su_dung_dich_vu(Ma_so)
);
CREATE TABLE dich_vu_sieu_am (
	Ma_so		CHAR(10) PRIMARY KEY,
    Loai_dau_do	VARCHAR(100),
    Ket_luan	VARCHAR(100),
    Chi_phi		INT,
    FOREIGN KEY (Ma_so) REFERENCES lan_su_dung_dich_vu(Ma_so)
);
CREATE TABLE hinh_thuc_hien_thi_ket_qua_sieu_am (
	Ma_so						CHAR(10) PRIMARY KEY,
    Hinh_thuc_hien_thi_ket_qua	VARCHAR(100),
    FOREIGN KEY (Ma_so) REFERENCES lan_su_dung_dich_vu(Ma_so)
);
CREATE TABLE dich_vu_kham_benh (
	Ma_so				CHAR(10) PRIMARY KEY,
    Ket_qua				VARCHAR(100),
    Chi_phi				INT,
    Ngay_hen_tiep_theo	DATE,
    Gio_hen_tiep_theo	TIME,
    FOREIGN KEY (Ma_so) REFERENCES lan_su_dung_dich_vu(Ma_so)
);
CREATE TABLE don_thuoc (
	Ma_don_thuoc	CHAR(10) PRIMARY KEY,
    Tong_tien_thuoc	INT,
    Ma_so			CHAR(10),
    FOREIGN KEY (Ma_so) REFERENCES dich_vu_kham_benh(Ma_so)
);
CREATE TABLE thuoc (
	Ma_thuoc	CHAR(10) PRIMARY KEY,
    Ten			VARCHAR(100),
    Gia_ban		INT,
    HDSD		VARCHAR(255)
);
CREATE TABLE don_thuoc_gom_thuoc (
	Ma_thuoc		CHAR(10),
    Ma_don_thuoc	CHAR(10),
    So_luong		INT,
    Lieu_Luong		INT,
    PRIMARY KEY (Ma_thuoc, Ma_don_thuoc),
    FOREIGN KEY (Ma_thuoc) REFERENCES thuoc(Ma_thuoc),
    FOREIGN KEY (Ma_don_thuoc) REFERENCES don_thuoc(Ma_don_thuoc)
);
CREATE TABLE dich_vu_luu_tru (
	Ma_so			CHAR(10) PRIMARY KEY,
    Ngay_bat_dau	DATE,
    Ngay_ket_thuc	DATE,
    Tong_chi_phi	INT,
    Tien_nghi		VARCHAR(100),
    FOREIGN KEY (Ma_so) REFERENCES lan_su_dung_dich_vu(Ma_so)
);
CREATE TABLE phong_benh (
	So_phong			CHAR(10) PRIMARY KEY,
    Loai_phong			VARCHAR(100),
    So_luong_benh_nhan	INT,
    Tinh_trang			VARCHAR(100)
);
CREATE TABLE phong_benh_duoc_su_dung_tai_dich_vu_luu_tru (
	So_phong				CHAR(10),
    Ma_so_dich_vu_luu_tru	CHAR(10),
    PRIMARY KEY (So_phong, Ma_so_dich_vu_luu_tru),
    FOREIGN KEY (So_phong) REFERENCES phong_benh(So_phong),
    FOREIGN KEY (Ma_so_dich_vu_luu_tru) REFERENCES dich_vu_luu_tru(Ma_so)
);
CREATE TABLE ngay_phong_benh_duoc_su_dung_tai_dich_vu_luu_tru (
	So_phong				CHAR(10),
    Ma_so_dich_vu_luu_tru	CHAR(10),
    Ngay_su_dung 			DATE,
    PRIMARY KEY (So_phong, Ma_so_dich_vu_luu_tru, Ngay_su_dung),
    FOREIGN KEY (So_phong, Ma_so_dich_vu_luu_tru) REFERENCES phong_benh_duoc_su_dung_tai_dich_vu_luu_tru(So_phong, Ma_so_dich_vu_luu_tru)
);
CREATE TABLE dieu_duong_tham_gia_dich_vu_luu_tru (
	Ma_so_nhan_vien			CHAR(10),
    Ma_so_dich_vu_luu_tru	CHAR(10),
    PRIMARY KEY (Ma_so_nhan_vien, Ma_so_dich_vu_luu_tru),
    FOREIGN KEY (Ma_so_nhan_vien) REFERENCES dieu_duong(Ma_so_nhan_vien),
    FOREIGN KEY (Ma_so_dich_vu_luu_tru) REFERENCES dich_vu_luu_tru(Ma_so)
);
CREATE TABLE ngay_tham_gia_cua_dieu_duong_phu_trach_dich_vu_luu_tru (
	Ma_so_nhan_vien			CHAR(10),
    Ma_so_dich_vu_luu_tru	CHAR(10),
    Ngay_phu_trach			DATE,
    PRIMARY KEY (Ma_so_nhan_vien, Ma_so_dich_vu_luu_tru, Ngay_phu_trach),
    FOREIGN KEY (Ma_so_nhan_vien, Ma_so_dich_vu_luu_tru) REFERENCES dieu_duong_tham_gia_dich_vu_luu_tru(Ma_so_nhan_vien, Ma_so_dich_vu_luu_tru)
);